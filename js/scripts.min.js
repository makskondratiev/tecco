//Мобильное меню
$('.header__burgermenu').click(function(){
	$(this).toggleClass("active");
	$('.header__side').toggleClass("active");
});

$('.header__side').on("swiperight",function(){
  	$(this).removeClass('active');
});

//Карточки на странице technology
$('.technology__card').click(function(){
	$('.technology__card').not(this).removeClass('active');
	$(this).toggleClass('active');
});

//Переключение вида блоков на странице cases
$('.cases__switcher li').click(function(){
	$(this).siblings().removeClass('active');
	$(this).addClass('active');
	var casewidth = $(this).attr('data-width');
	if ( casewidth == "squares" ) {
		$('.cases__list').addClass('squares');
	} else {
		$('.cases__list').removeClass('squares');
	}
});

//Карта на странице contacts в мобилке
$('.contacts__pinsquare').click(function(){
	$(this).toggleClass('active');
	$('.contacts__map').toggleClass('active');
});

//Фильтр кейсов
$('.case__filter').click(function(e){
	e.preventDefault();
	$('.case__filter.active').removeClass('active');
	$(this).addClass('active');
	var category = $(this).attr('data-category');
	if (category == "all") {
		$('.cases__list > li').show();
	} else {
		$('.cases__list > li').hide();
		$('.cases__list > li[data-category='+category+']').show();
	}
});

//Поделиться на странице кейса
$('.squareblock__social').click(function(e){
	e.preventDefault();
	alert("Hello!");
})



// Плавное появление блоков при скролле
window.sr = ScrollReveal();
var fooReveal = {delay: 100, distance: '50px', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: false, duration: 1000};
var fooReveal1 = {delay: 200, distance: '50px', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: false, duration: 1000};
var fooReveal2 = {delay: 300, distance: '50px', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: false, duration: 1000};
var fooReveal3 = {delay: 400, distance: '50px', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: false, duration: 1000};
sr.reveal('.content__heading, .content__text, .company__quotetext, .company__quoteauthor, .content__scroll-link, .content__bgphone, .services__list, .services__quote, .case__smalltext, .content-tabs p, .case__logo, .case__subheading, .cases__text, .case__about__text, .case__about__list', fooReveal);
sr.reveal('.content__scroll-link, .technology__column:nth-child(1), .technology__column:nth-child(2)', fooReveal1);
sr.reveal('.content__scroll-link, .technology__column:nth-child(3), .technology__column:nth-child(4)', fooReveal2);
sr.reveal('.content__scroll-link, .technology__column:nth-child(5), .technology__column:nth-child(6)', fooReveal3);




// Фиксировать экран для самописных модальных окон
function fixscreen() {
  window.scroll = $(window).scrollTop();
  $("body").css('top', -scroll + 'px').toggleClass('noscroll');
}

function unfixscreen() {
  $("body").css('top', "0").toggleClass('noscroll');
  $(window).scrollTop(scroll);
}



// Показ прелоадера при отправке формы
$(document).on({
  ajaxStart: function() { $(".preloader").addClass("active");},
  ajaxStop: function() { $(".preloader").removeClass("active");}
});



// Плавно скрыть/показать блок
function hideblock(el) {
  setTimeout(function() {$(el).show();}, 700);
  setTimeout(function() {$(el).css("opacity", "1");}, 900);
}

function showblock(el) {
  setTimeout(function() {$(el).css("opacity", "0");}, 700);
  setTimeout(function() {$(el).show();}, 900);
}



// Ссылки навигации по странице (добавить класс nav к ссылке с #)
$("a.nav").click(function(event){     
    event.preventDefault();
    $('html,body').animate({scrollTop:$(this.hash).offset().top}, 1200);
});



// AJAX форма
$(document).ready(function() {
    $('.contacts__form').ajaxForm(function() {
		$('.contacts__form').find('input, textarea, button, p').addClass('active');
    }); 
}); 



// Маска для поля ввода телефона
$(document).ready(function(){
   $("input[name='tel']").inputmask("+7 (999) 999-99-99");
});



// Кросс-браузерный Placeholder
function supports_input_placeholder() {var i = document.createElement('input'); return 'placeholder' in i;}

if (!supports_input_placeholder()) {
  var fields = document.getElementsByTagName('INPUT');
  for(var i=0; i < fields.length; i++) {
    if(fields[i].hasAttribute('placeholder')) {
      fields[i].defaultValue = fields[i].getAttribute('placeholder');
      fields[i].onfocus = function() { if(this.value == this.defaultValue) this.value = ''; }
      fields[i].onblur = function() { if(this.value == '') this.value = this.defaultValue; }
    }
  }
}

// Выделение элемента меню при нахождении на соответствующей странице
$(document).ready(function(){
	var page = $('section').data('page');
	console.log(page);
	$('.header__menu a[data-page='+page+']').addClass('active');
});



// Проверка формы на правильность введенных данных
$(".contacts__form button").click(function(e){
	e.preventDefault();
    window.activeform = $(this).parents("form").attr("id");

    checkinputs();
    checkandsubmit();
});


// 2. Проверка текстовых input'ов
function checkinputs() {
    // Проверка обычных полей на заполненность
    checkempty();

    // Проверка поля email
    function isEmail(email) {
        var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
        return regex.test(email);
    }
    if ( isEmail($('#'+activeform+' input[name="email"]').val()) === false) {
        $('#'+activeform+' input[name="email"]').addClass("error")
    } else {$('#'+activeform+' input[name="email"]').removeClass("error")}
}

// 3. Проверка на ошибочные поля и отправка формы
function checkandsubmit() {
    window.formerrors = 0;
    $('#'+activeform).find(".error").each(function(){
        formerrors += 1;
    });
    if (formerrors === 0) {
        $('#'+activeform).submit();
    }
}

// Скрипт проверки на пустое значение
function checkempty() {
    $('#'+activeform+' [data-required]').each(function(){
        if (!$(this).val()) {
            $(this).addClass("error")
        } else {$(this).removeClass("error")}
    });
}

// Убрать ошибку при изменении input'а
$("input, textarea").on("keyup change", function(){
   $(this).removeClass("error");
});


//Появление блока с кейсами на главной
$(document).ready(function(){
	$('.page-main .content-tabs__switcher li[data-width="squares"]').click();
	var mainHeight = $('.content_main').outerHeight();
	$('.page-main').css('max-height', ''+(mainHeight+150)+'px');
	$('.page-main__wrapper').outerHeight(mainHeight);
})

$('.content_main .content__scroll-link').click(function(e){
	e.preventDefault();
	$('.page-main__wrapper').height(0);
	$('.page-main').addClass('active');
	$('.page-main').css('max-height', '1000000px');
});


// Параллакс
// Картинка на странице "Пациентам"
function parallax() {
    var el = $(".company__cityview");
    var h1 = el.offset().top;
    var blockheight = el.outerHeight();
    var scroll = $(window).scrollTop();
    if ( (scroll > (h1 - $(window).height())) ) {
        var percents = scroll/blockheight;
        $(".company__cityview img.colored").css("transform", "translate3d(0,"+(178-percents*200)+"px,0)");
    }
}

// Запускаем параллакс
$(window).scroll(function(){
	if ($('*').is('.company__cityview')) {
		parallax();
	}
});